<div class="page-title">
  <div class="title_left">
    <h3>Danh sách người dùng</h3>
  </div>

  <div class="title_right">
    <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
      <div class="input-group">
        <input type="text" class="form-control" (keyup.enter)="loadData()" [(ngModel)]="filter" name="filter" placeholder="Gõ tên quyền...">
        <span class="input-group-btn">
          <button class="btn btn-default" type="button" (click)="loadData()">Tìm!</button>
        </span>
      </div>
    </div>
  </div>
</div>
<div class="clearfix"></div>
<div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <ul class="nav navbar-right panel_toolbox">
          <li>
            <button class="btn btn-success" (click)="openModal(template, null)">Add</button>
          </li>
        </ul>
        <div class="clearfix"></div>
      </div>
      <div class="x_content">

        <table class="table table-bordered">
          <thead>
            <tr>
              <th>STT</th>
              <th>Tên</th>
              <th>Email</th>
              <th>Số điện thoại</th>
              <th>Giới tính</th>
              <th>Ngày sinh</th>
              <th>Địa chỉ</th>
              <th>Avatar</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let entity of entities let i = index">
              <td>{{i+1}}</td>
              <td>{{entity.FullName}}</td>
              <td>{{entity.Email}}</td>
              <td>{{entity.PhoneNumber}}</td>
              <td>{{entity.Gender}}</td>
              <td>{{entity.BirthDay}}</td>
              <td>{{entity.Address}}</td>
              <td><img src="{{entity.Avatar}}" alt=""></td>
              <td>{{entity.status}}</td>
              <td>
                <button class="btn btn-primary" (click)="openModal(template, entity)"><i class="fa fa-pencil-square-o"></i></button>
                <button class="btn btn-danger" (click)="openModalConfirm(templateDelete, entity)"><i class="fa fa-trash"></i></button>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="col-md-12 cold-xs-12 col-12">
          <pagination [totalItems]="totalRows" [itemsPerPage]="pageSize" [(ngModel)]="pageIndex" (pageChanged)="pageChanged($event)"></pagination>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #template>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Form User</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="formEntity" class="form-horizontal form-label-left" novalidate (ngSubmit)="saveChange()">

      <input type="hidden" id="Id" formControlName="Id" name="Id" class="form-control col-md-7 col-xs-12">
      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">FullName
        </label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="text" name="FullName" formControlName="FullName" class="form-control col-md-7 col-xs-12">
        </div>
        <div class="col-md-offset-3 col-md-9 col-sm-9 col-xs-12" *ngIf="isError('FullName')">
          <small [hidden]="!isErrorRequired('FullName')" class="text-danger">
            FullName is required field!
          </small>
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">UserName
        </label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="text" name="UserName" formControlName="UserName" class="form-control col-md-7 col-xs-12">
        </div>
        <div class="col-md-offset-3 col-md-9 col-sm-9 col-xs-12" *ngIf="isError('UserName')">
          <small [hidden]="!isErrorRequired('UserName')" class="text-danger">
            UserName is required field!
          </small>
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">Password
        </label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="password" name="Password" formControlName="Password" class="form-control col-md-7 col-xs-12">
        </div>
        <div class="col-md-offset-3 col-md-9 col-sm-9 col-xs-12" *ngIf="isError('Password')">
          <small [hidden]="!isErrorRequired('Password')" class="text-danger">
            Password is required field!
          </small>
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">Email
        </label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="text" name="Email" formControlName="Email" class="form-control col-md-7 col-xs-12">
        </div>
        <div class="col-md-offset-3 col-md-9 col-sm-9 col-xs-12" *ngIf="isError('Email')">
          <small [hidden]="!isErrorRequired('Email')" class="text-danger">
            Email is required field!
          </small>
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">Phone 
        </label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="text" id="PhoneNumber" formControlName="PhoneNumber" class="form-control col-md-7 col-xs-12">
        </div>
        <div class="col-md-offset-3 col-md-9 col-sm-9 col-xs-12" *ngIf="isError('PhoneNumber')">
          <div [hidden]="!isErrorRequired('PhoneNumber')" class="text-danger">
            PhoneNumber is required field!
          </div>
          <small [hidden]="!isErrorMinLength('PhoneNumber')" class="text-danger">
            PhoneNumber is least at 4 characters long!
          </small>
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">Gender</label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="radio" (change)="selectGender($event)" [checked]="formEntity.Gender=='True'" formControlName="Gender" value="True"
            required />Male        
          <input type="radio" (change)="selectGender($event)" [checked]="formEntity.Gender=='False'" formControlName="Gender" value="False"
          />Female
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">BirthDay
        </label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="text" class="form-control" #dp="bsDatepicker" [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY' }" bsDatepicker [bsValue]="bsValue"
            formControlName="BirthDay">
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">Address
        </label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="text" name="Address" formControlName="Address" class="form-control col-md-7 col-xs-12">
        </div>
        <div class="col-md-offset-3 col-md-9 col-sm-9 col-xs-12" *ngIf="isError('Address')">
          <small [hidden]="!isErrorRequired('Address')" class="text-danger">
            Address is required field!
          </small>
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">Avatar</label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="file" #avatar name="avatar" class="form-control">
          <p class="help-block label label-danger"> chỉ hỗ trợ định dạng *.png, *.jpg, *.jpeg </p>
          <input type="hidden" formControlName="Avatar" name="avatarUrl" />
        </div>

        <div class="col-md-3 col-sm-3 col-xs-12" *ngIf="formEntity.Avatar">
          <img [src]="formEntity.Avatar" width="128" />
        </div>
      </div>

      <div class="form-group" *ngIf="formEntity.Id">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">Status
        </label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <input type="text" name="Status" formControlName="Status" class="form-control col-md-7 col-xs-12">
        </div>
        <div class="col-md-offset-3 col-md-9 col-sm-9 col-xs-12" *ngIf="isError('Status')">
          <small [hidden]="!isErrorRequired('Status')" class="text-danger">
            Status is required field!
          </small>
        </div>
      </div>

      <div class="form-group">
        <label class="control-label col-md-3 col-sm-3 col-xs-12">Roles
        </label>
        <div class="col-md-9 col-sm-9 col-xs-12">
          <ng-multiselect-dropdown [placeholder]="'custom placeholder'" [data]="dropdownList" [(ngModel)]="selectedItems" [settings]="dropdownSettings"
            (onSelect)="onItemSelect($event)" (onSelectAll)="onSelectAll($event)" formControlName="Roles">
          </ng-multiselect-dropdown>
        </div>
      </div>

      <div class="ln_solid"></div>
      <div class="form-group">
        <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
          <button class="btn btn-primary" type="button" (click)="modalRef.hide()">Cancel</button>
          <button class="btn btn-primary" type="reset" (click)="reset()">Reset</button>
          <button type="submit" class="btn btn-success" [disabled]="!formEntity.valid">Submit</button>
        </div>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #templateDelete>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Confirm Delete</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body text-center">
    <h4>Do you want delete this record?</h4>
    <div class="ln_solid"></div>
    <button type="button" class="btn btn-default" (click)="delete()">Yes</button>
    <button type="button" class="btn btn-primary" (click)="modalRef.hide()">No</button>
  </div>
</ng-template>